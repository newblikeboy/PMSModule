<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>QuantPulse Admin Console</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <link rel="stylesheet" href="./styles/landing.css" />
  <link rel="stylesheet" href="./styles/admin.css" />
</head>
<body class="admin-shell">

  <header class="admin-bar">
    <div class="container admin-bar-inner">
      <div class="admin-brand">
        <span class="admin-logo">QP</span>
        <div class="admin-brand-meta">
          <span class="admin-brand-name">QuantPulse Console</span>
          <span class="admin-brand-tag">Founder / Internal Only</span>
        </div>
      </div>

      <button type="button" class="admin-bar-btn" id="adminLogoutBtn">Logout</button>
    </div>
  </header>

  <nav class="admin-nav">
    <div class="container admin-nav-inner">
      <button class="admin-tab-btn active" data-tab="overviewTab">Overview</button>
      <button class="admin-tab-btn" data-tab="tradesTab">Trades</button>
      <button class="admin-tab-btn" data-tab="usersTab">Users</button>
      <button class="admin-tab-btn" data-tab="systemTab">System Control</button>
    </div>
  </nav>

  <main class="admin-main">
    <div class="container admin-tabs-wrap">

      <section class="admin-tab-section" id="overviewTab">
        <div class="admin-kpi-grid">
          <article class="admin-kpi-card">
            <span class="admin-kpi-label">Closed trades (today)</span>
            <span class="admin-kpi-value" id="ovClosedTrades">--</span>
            <span class="admin-kpi-foot" id="ovWinLoss">Wins / Losses: --</span>
          </article>
          <article class="admin-kpi-card">
            <span class="admin-kpi-label">Net PnL today</span>
            <span class="admin-kpi-value" id="ovPnL">--</span>
            <span class="admin-kpi-foot" id="ovBestTrade">Best trade: --</span>
          </article>
          <article class="admin-kpi-card">
            <span class="admin-kpi-label">Open paper trades</span>
            <span class="admin-kpi-value" id="ovOpenTrades">--</span>
            <span class="admin-kpi-foot">Current simulated exposure in market.</span>
          </article>
          <article class="admin-kpi-card">
            <span class="admin-kpi-label">Automation enabled users</span>
            <span class="admin-kpi-value" id="ovAutoUsers">--</span>
            <span class="admin-kpi-foot">Users with autoTradingEnabled = true.</span>
          </article>
        </div>

        <div class="admin-slab">
          <div class="admin-slab-head">
            <div>
              <h2 class="admin-slab-title">Live Signals Snapshot</h2>
              <p class="admin-slab-sub">Symbols currently inside our equity entry zone criteria.</p>
            </div>
            <button type="button" class="admin-refresh-btn" data-reload="signals">Refresh</button>
          </div>

          <div class="admin-table-wrap">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>Symbol</th>
                  <th>Entry Price</th>
                  <th>Target</th>
                  <th>Stop</th>
                  <th>Why Listed</th>
                </tr>
              </thead>
              <tbody id="adminSignalsTbody">
                <tr>
                  <td colspan="5" class="admin-table-placeholder">Loading...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <section class="admin-tab-section hidden" id="tradesTab">
        <div class="admin-slab">
          <div class="admin-slab-head">
            <div>
              <h2 class="admin-slab-title">Today's Trades (Paper)</h2>
              <p class="admin-slab-sub">Open and closed positions streamed from the trade engine.</p>
            </div>
            <button type="button" class="admin-refresh-btn" data-reload="trades">Refresh</button>
          </div>

          <div class="admin-table-wrap">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Symbol</th>
                  <th>Qty</th>
                  <th>Entry</th>
                  <th>Current</th>
                  <th>Target</th>
                  <th>Stop</th>
                  <th>P&L</th>
                  <th>Status</th>
                  <th>Action</th>
                </tr>
              </thead>
              <tbody id="adminTradesTbody">
                <tr>
                  <td colspan="10" class="admin-table-placeholder">Loading...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <section class="admin-tab-section hidden" id="usersTab">
        <div class="admin-slab">
          <div class="admin-slab-head">
            <div>
              <h2 class="admin-slab-title">Users &amp; Access</h2>
              <p class="admin-slab-sub">Manage plans, Angel linkage, margin budgets and automation rights.</p>
            </div>
            <button type="button" class="admin-refresh-btn" data-reload="users">Refresh</button>
          </div>

          <div class="admin-table-wrap">
            <table class="admin-table">
              <thead>
                <tr>
                  <th>User</th>
                  <th>Email</th>
                  <th>Plan</th>
                  <th>Broker</th>
                  <th>Angel Margin</th>
                  <th>Angel Live</th>
                  <th>Automation</th>
                  <th>Created</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="adminUsersTbody">
                <tr>
                  <td colspan="9" class="admin-table-placeholder">Loading...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <section class="admin-tab-section hidden" id="systemTab">
        <div class="admin-slab-grid">

          <div class="admin-slab">
            <div class="admin-slab-head">
              <div>
                <h2 class="admin-slab-title">System Health</h2>
                <p class="admin-slab-sub">Internal services, queues and background schedulers.</p>
              </div>
              <button type="button" class="admin-refresh-btn" data-reload="system">Refresh</button>
            </div>

            <div class="admin-table-wrap">
              <table class="admin-table">
                <thead>
                  <tr>
                    <th>Service</th>
                    <th>Status</th>
                    <th>Notes</th>
                    <th>Updated</th>
                  </tr>
                </thead>
                <tbody id="adminSystemTbody">
                  <tr>
                    <td colspan="4" class="admin-table-placeholder">Loading...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <div class="admin-slab">
            <div class="admin-slab-head">
              <div>
                <h2 class="admin-slab-title">Angel Login Assistant</h2>
                <p class="admin-slab-sub">
                  Generate the publisher login link for a user and share it securely.
                </p>
              </div>
            </div>

            <div class="admin-broker">
              <div class="broker-status-row">
                <label class="broker-status-label" for="angelAssistUser">User ID or Email</label>
                <input id="angelAssistUser" class="broker-url-input" type="text" placeholder="Enter user ID or email" />
              </div>
              <div class="broker-url-row">
                <button type="button" class="admin-mini-btn" id="angelGenerateLoginBtn">Generate Login URL</button>
                <button type="button" class="admin-mini-btn" id="angelLaunchLoginBtn">Open in New Window</button>
              </div>
              <div class="broker-url-row">
                <input id="angelLoginLink" class="broker-url-input" type="text" placeholder="Generated login link appears here" readonly />
              </div>
              <div class="broker-step-help" id="angelAssistMsg"></div>
            </div>
          </div>

          <div class="admin-slab">
            <div class="admin-slab-head">
              <div>
                <h2 class="admin-slab-title">Scanner Engine (M1)</h2>
                <p class="admin-slab-sub">Real-time 5% movers scanner running on live market feed.</p>
              </div>
              <button type="button" class="admin-refresh-btn" data-reload="engine">Refresh</button>
            </div>

            <div class="admin-engine">
              <div class="engine-meta-block">
                <div class="engine-status-line">
                  <span class="label">Status:</span>
                  <span id="engineStatusPill" class="pill-off">OFF</span>
                </div>
                <div class="engine-meta">
                  <div><span class="label">Before cutoff:</span> <span id="engineBeforeCutoff">--</span></div>
                  <div><span class="label">Last error:</span> <span id="engineLastError">--</span></div>
                </div>
              </div>
              <div class="engine-controls">
                <button type="button" class="admin-mini-btn" id="btnEngineStart">Start Engine</button>
                <button type="button" class="admin-mini-btn danger" id="btnEngineStop">Stop Engine</button>
              </div>
            </div>
          </div>

          <div class="admin-slab">
            <div class="admin-slab-head">
              <div>
                <h2 class="admin-slab-title">Fyers Access Tokens</h2>
                <p class="admin-slab-sub">Monitor auth state used for quote streaming and refresh on demand.</p>
              </div>
              <div class="admin-slab-head-actions">
                <button type="button" class="admin-mini-btn" id="fyersStatusReloadBtn">Check Status</button>
                <button type="button" class="admin-mini-btn pay" id="fyersForceRefreshBtn">Force Refresh</button>
                <button type="button" class="admin-mini-btn" id="fyersLoginBtn">Open Login Flow</button>
              </div>
            </div>

            <div class="broker-token-grid">
              <div class="broker-token-row">
                <span class="label">Access token</span>
                <span class="value" id="fyersAccessState">--</span>
              </div>
              <div class="broker-token-row">
                <span class="label">Refresh token</span>
                <span class="value" id="fyersRefreshState">--</span>
              </div>
              <div class="broker-token-row">
                <span class="label">Token issued</span>
                <span class="value" id="fyersTokenIssued">--</span>
              </div>
              <div class="broker-token-row">
                <span class="label">Expires</span>
                <span class="value" id="fyersTokenExpiry">--</span>
              </div>
              <div class="broker-token-row">
                <span class="label">Last auto refresh</span>
                <span class="value" id="fyersAutoRefresh">--</span>
              </div>
              <div class="broker-token-row">
                <span class="label">Last manual refresh</span>
                <span class="value" id="fyersManualRefresh">--</span>
              </div>
            </div>

            <div class="broker-token-actions">
              <div class="broker-step-row">
                <label for="fyersAuthCodeInput">Auth Code</label>
                <input id="fyersAuthCodeInput" type="text" placeholder="Paste auth_code here" />
                <button type="button" class="admin-mini-btn" id="fyersExchangeBtn">Exchange Auth Code</button>
              </div>
              <div class="broker-step-help" id="fyersStatusMsg"></div>
            </div>
          </div>

          <div class="admin-slab">
            <div class="admin-slab-head">
              <div>
                <h2 class="admin-slab-title">Angel Token Status</h2>
                <p class="admin-slab-sub">Track saved publisher tokens and refresh timestamps.</p>
              </div>
              <button type="button" class="admin-refresh-btn" id="angelStatusReloadBtn" data-reload="broker">Refresh</button>
            </div>

            <div class="broker-token-grid">
              <div class="broker-token-row">
                <span class="label">Linked users</span>
                <span class="value" id="angelLinkedUsers">--</span>
              </div>
              <div class="broker-token-row">
                <span class="label">With live enabled</span>
                <span class="value" id="angelLiveUsers">--</span>
              </div>
              <div class="broker-token-row">
                <span class="label">Average margin cap</span>
                <span class="value" id="angelAvgMargin">--</span>
              </div>
            </div>

            <div class="broker-token-actions">
              <button type="button" class="admin-mini-btn" id="angelRefreshSummaryBtn">Refresh Summary</button>
              <div class="broker-step-help" id="angelSummaryMsg"></div>
            </div>
          </div>

          <div class="admin-slab">
            <div class="admin-slab-head">
              <div>
                <h2 class="admin-slab-title">Live Data Stream</h2>
                <p class="admin-slab-sub">Most recent tick updates received from the data socket.</p>
              </div>
              <button type="button" class="admin-mini-btn danger" id="btnClearSocketLog">Clear</button>
            </div>

            <div class="admin-stream-box" id="socketStreamBox">
              <div>Awaiting live ticks...</div>
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <footer class="admin-foot">
    <div class="container admin-foot-inner">
      <div>&copy; <span id="yearNow"></span> QuantPulse Internal Console.</div>
      <div>Confidential - Do not share externally.</div>
    </div>
  </footer>

  <script src="./js/admin.js"></script>
</body>
</html>
